@page "/"
@using LD_15_Ryzovas.Data
@inject IInOut InOut;

<h1>Hello, world!</h1>

Welcome to your new app.
<br />
Enter folder name
<input @bind="FolderName" />
<button @onclick="OnLoad">Nuskaityti failus</button>
@if (AllPublications.Count != 0)
{
    @foreach (var year in Years)
    {
    <p><strong>@year metai</strong> </p>
        <table>
            <thead>
            <tr>
                <td>Prenumeratoriaus pavardė</td>
                <td>Adresas</td>
                <td>Laikotarpio pradžia</td>
                <td>Laikotarpio ilgis</td>
                <td>Leidinių kiekis</td>
                <td>Agento kodas</td>
            </tr>
            </thead>
            @foreach (var publication in AllPublications.Where(x => x.Year == year))
            {
                <tr>
                    <td>@publication.SubSurname</td>
                    <td>@publication.Adress</td>
                    <td>@publication.DataStart</td>
                    <td>@publication.DataLength</td>
                    <td>@publication.PubCount</td>
                    <td>@publication.AgentNr</td>
                </tr>
            }
        </table>
        <br/>
     }
    

    <input @bind="MonthToFindCharges" />
    <button @onclick="GetCharge">Gauti krūvį</button>

    @foreach (var charge in AgentsCharges)
    {
        <table>

            <thead>
                <tr>
                    <td>Agento numeris</td>
                    <td>Agento pavardė</td>
                    <td>Agento vardas</td>
                    <td>Agento krūvis</td>
                </tr>
            </thead>
            <tr>
                <td>@charge.Key.AgentNr</td>
                <td>@charge.Key.AgentSurname</td>
                <td>@charge.Key.AgentName</td>
                <td>@charge.Value</td>
            </tr>


        </table>
    }
<table>
    @foreach (var x in Years)
    {


        <tr>
            @x
        </tr>



    }
</table>
}



        @code
{
    public string FolderName { get; set; }
        List<Publication> AllPublications { get; set; } = new List<Publication>();
        List<Agent> Agents { get; set; } = new List<Agent>();
        string AgentNumber { get; set; }
        int MonthToFindCharges { get; set; }
        Dictionary<Agent, int> AgentsCharges { get; set; } = new Dictionary<Agent, int>();
        List<int> Years { get; set; } = new List<int>();

        void OnLoad()
        {
            try
            {
                AllPublications = InOut.ReadAllFiles(@"" + FolderName);
                Agents = InOut.ReadAgents(@"Agents.txt");
            }
            catch (Exception e)
            {
                throw new NotImplementedException();
            }
           
        }

        void GetCharge()
        {
            AgentsCharges = ProgramServices.GetAgentsCharge(Agents, AllPublications, MonthToFindCharges);
            Years = ProgramServices.GetYears(AllPublications);
        }
  }
